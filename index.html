<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Wheel Library</title>

  <!-- Fun, bubbly retro-ish fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&family=Space+Grotesk:wght@400;500&display=swap" rel="stylesheet" />

  <!-- Optional PWA bits -->
  <meta name="theme-color" content="#1b1024" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Wheel Library" />
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="manifest" href="./manifest.json" />

  <style>
    :root {
      /* Icon-ish / retro rink palette */
      --bg: #1b1024;        /* deep plum (night rink) */
      --peach: #ff9b73;
      --peach-dark: #e86c3b;
      --gold: #f7c948;
      --mint: #58c2a3;
      --brown: #5b3b2e;
      --cream: #fff7e7;
      --ink: #2c2137;

      --panel: rgba(255, 255, 255, 0.92);
      --panel-border: rgba(91, 59, 46, 0.22);
      --shadow: rgba(0, 0, 0, 0.22);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Space Grotesk", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at 10% 10%, rgba(255, 155, 115, 0.22) 0, transparent 55%),
        radial-gradient(circle at 90% 15%, rgba(247, 201, 72, 0.18) 0, transparent 55%),
        radial-gradient(circle at 15% 90%, rgba(88, 194, 163, 0.18) 0, transparent 55%),
        var(--bg);
      color: var(--ink);
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .shell {
      width: 100%;
      max-width: 980px;
      background: linear-gradient(145deg, #fff2df 0%, #ffe7d7 45%, #fff1fb 100%);
      border-radius: 24px;
      border: 4px solid var(--brown);
      box-shadow: 0 18px 35px var(--shadow), 0 0 0 6px rgba(255,255,255,0.18);
      padding: 18px 18px 22px;
      position: relative;
      overflow: hidden;
    }

    /* Subtle retro ribbon (NOT rainbow) */
    .shell::before {
      content: "";
      position: absolute;
      inset: 0;
      top: -55%;
      background: linear-gradient(
        to right,
        rgba(255,155,115,0.35) 0%,
        rgba(247,201,72,0.28) 35%,
        rgba(88,194,163,0.24) 65%,
        rgba(255,155,115,0.35) 100%
      );
      opacity: 0.55;
      transform: rotate(-4deg);
      pointer-events: none;
    }

    .content { position: relative; z-index: 1; }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    .logo-badge {
      width: 68px;
      height: 68px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fffadd 0, #ffe0c2 45%, var(--peach) 80%);
      border: 4px solid var(--brown);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Baloo 2", system-ui, sans-serif;
      font-weight: 700;
      font-size: 26px;
      color: var(--brown);
      box-shadow: 0 6px 0 rgba(91, 59, 46, 0.25);
    }

    .title-block { flex: 1; min-width: 180px; }

    h1 {
      font-family: "Baloo 2", system-ui, sans-serif;
      font-size: 1.7rem;
      line-height: 1.1;
      margin: 0 0 4px;
      color: var(--brown);
      letter-spacing: 0.03em;
      text-shadow: 0 2px 0 rgba(255,255,255,0.85);
    }

    .subtitle {
      font-size: 0.92rem;
      color: #6b4e42;
    }

    .badge-strip {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .tiny-badge {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.88);
      color: var(--brown);
    }

    .actions-top {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
      min-width: 150px;
    }

    .reset-btn {
      border-radius: 999px;
      border: 2px solid var(--brown);
      padding: 6px 12px;
      background: var(--cream);
      font-size: 0.82rem;
      font-weight: 700;
      cursor: pointer;
      color: var(--brown);
      box-shadow: 0 3px 0 rgba(91,59,46,0.35);
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s;
    }

    .reset-btn:active {
      transform: translateY(2px);
      box-shadow: 0 1px 0 rgba(91,59,46,0.35);
    }

    .pill-indicator {
      padding: 4px 10px;
      border-radius: 999px;
      background: linear-gradient(120deg, rgba(88,194,163,0.9), rgba(247,201,72,0.85));
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--ink);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 2px 0 rgba(0,0,0,0.18);
    }

    #dataStatus.pill-indicator.live {
      background: linear-gradient(120deg, rgba(88,194,163,0.95), rgba(181,243,222,0.95));
    }

    #dataStatus.pill-indicator.offline {
      background: linear-gradient(120deg, rgba(255,118,117,0.95), rgba(255,234,167,0.95));
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.1fr);
      gap: 16px;
      align-items: start;
    }

    @media (max-width: 780px) {
      main { grid-template-columns: 1fr; }
    }

    .panel {
      background: var(--panel);
      border-radius: 18px;
      border: 2px solid var(--panel-border);
      padding: 12px 12px 14px;
      box-shadow: 0 6px 0 rgba(0,0,0,0.05);
    }

    .panel h2 {
      margin: 0 0 10px;
      font-size: 1.05rem;
      font-family: "Baloo 2", system-ui, sans-serif;
      color: var(--brown);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .group { margin-bottom: 10px; }

    .group-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #7f5a4a;
      margin-bottom: 6px;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      padding: 7px 11px;
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.18);
      background: linear-gradient(135deg, #fffdf5, #ffe8d7);
      font-size: 0.82rem;
      cursor: pointer;
      color: var(--brown);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 0 rgba(0,0,0,0.12);
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s, border-color 0.1s;
    }

    .chip-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: var(--mint);
      box-shadow: 0 0 0 2px rgba(88, 194, 163, 0.35);
    }

    .chip.selected {
      background: linear-gradient(135deg, var(--peach), var(--gold));
      color: var(--ink);
      border-color: var(--brown);
      transform: translateY(1px);
      box-shadow: 0 1px 0 rgba(0,0,0,0.16);
    }

    .chip.selected .chip-dot {
      background: var(--cream);
      box-shadow: 0 0 0 2px rgba(255, 247, 231, 0.7);
    }
        /* Colored outlines for each pill group */
    .group[data-group="environment"] .chip {
      border-color: var(--neon-blue);
      border-width: 2px;
    }
    
    .group[data-group="size"] .chip {
      border-color: var(--neon-lime);
      border-width: 2px;
    }
    
    .group[data-group="duro"] .chip {
      border-color: var(--neon-pink);
      border-width: 2px;
    }
    
    .group[data-group="material"] .chip {
      border-color: var(--neon-purple);
      border-width: 2px;
    }


    #output {
      font-size: 0.86rem;
      color: #5d4940;
      line-height: 1.4;
    }

    #output ul { padding-left: 18px; margin: 6px 0 8px; }
    #output p { margin: 4px 0; }

    .hint {
      font-size: 0.78rem;
      color: #9b7a6a;
      margin-top: 4px;
    }

    .data-meta {
      margin: 6px 0 10px;
      font-size: 0.78rem;
      color: #7e6257;
      padding: 6px 10px;
      border-radius: 12px;
      background: rgba(255, 247, 231, 0.7);
      border: 1px dashed rgba(91, 59, 46, 0.25);
    }

    #matches {
      font-size: 0.86rem;
      color: #4c3a35;
    }

    .matches-empty {
      padding: 8px 10px;
      border-radius: 12px;
      background: #fff7e7;
      border: 1px dashed rgba(91, 59, 46, 0.35);
      text-align: center;
      font-size: 0.82rem;
      margin-bottom: 8px;
    }

    .wheel-card {
      border-radius: 14px;
      border: 1px solid rgba(91, 59, 46, 0.18);
      padding: 8px 10px;
      background: linear-gradient(135deg, #fffdf7, #ffeae5);
      margin-bottom: 8px;
      box-shadow: 0 2px 0 rgba(0,0,0,0.08);
    }

    .wheel-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
    }

    .wheel-name { font-weight: 700; font-size: 0.95rem; }

    .wheel-availability {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: #e8ffe9;
      border: 1px solid #2d8a4d;
      color: #205d35;
      font-weight: 800;
    }

    .wheel-availability.none {
      background: #ffe8e8;
      border-color: #b3261e;
      color: #7b1510;
    }

    .tag-row {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.16);
      background: rgba(255,255,255,0.9);
      font-size: 0.72rem;
    }

    .tag-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--peach);
    }

    .wheel-footer {
      margin-top: 6px;
      font-size: 0.76rem;
      color: #7e6257;
      display: flex;
      justify-content: space-between;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .borrow-btn {
      border-radius: 999px;
      border: 1px solid var(--brown);
      padding: 5px 10px;
      font-size: 0.78rem;
      font-weight: 800;
      background: linear-gradient(135deg, #ffe7d9, #ffd2c5);
      color: var(--brown);
      cursor: pointer;
      box-shadow: 0 2px 0 rgba(0,0,0,0.12);
      white-space: nowrap;
    }

    .borrow-btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 0 rgba(0,0,0,0.12);
    }

    .footnote {
      margin-top: 8px;
      font-size: 0.75rem;
      color: #8a6c60;
      border-top: 1px dashed rgba(0,0,0,0.12);
      padding-top: 6px;
    }

    #loanLog {
      margin-top: 10px;
      border-top: 1px dashed rgba(0,0,0,0.12);
      padding-top: 8px;
      font-size: 0.8rem;
    }

    #loanLog h3 {
      margin: 0 0 6px;
      font-size: 0.85rem;
      font-family: "Baloo 2", system-ui, sans-serif;
      color: var(--brown);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .loan-item {
      padding: 4px 0;
      border-bottom: 1px dotted rgba(0,0,0,0.12);
    }

    .loan-item:last-child { border-bottom: none; }

    .loan-main {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .loan-borrower { font-weight: 800; }

    .loan-note {
      color: #87685b;
      font-size: 0.75rem;
      margin-top: 2px;
    }

    /* Mobile */
    @media (max-width: 780px) {
      body { padding: 10px; }
      .shell { border-radius: 18px; padding: 12px; }
      header { gap: 10px; margin-bottom: 12px; }
      h1 { font-size: 1.45rem; }
      .subtitle { font-size: 0.95rem; line-height: 1.25; }
      main { grid-template-columns: 1fr !important; gap: 12px; }
      .panel { padding: 14px; }
      .chip, .reset-btn, .borrow-btn {
        padding: 10px 14px;
        font-size: 0.95rem;
      }
      .wheel-name { font-size: 1rem; }
      .tag { font-size: 0.85rem; padding: 6px 10px; }
    }

/* =========================
   MSW RINK RUG THEME OVERRIDES
   Real MSW carpet colors!
   ========================= */

:root{
  --ink: #f4f2ff;
  --brown: #241b2f;
  --cream: rgba(255,255,255,.08);

  --bg0: #0d0d0d;
  --bg1: #1a1a1a;
  --panel: rgba(26, 26, 26, .68);

  --neon-pink: #ff1493;
  --neon-blue: #00bfff;
  --neon-lime: #bfff00;
  --neon-purple: #9b30ff;
  --neon-orange: #ff6b35;
  --neon-yellow: #ffd700;

  --stroke: rgba(255,255,255,.14);
  --stroke-strong: rgba(255,255,255,.22);
  --shadow: rgba(0,0,0,.50);
}

body{
  color: var(--ink);
  background:
    radial-gradient(circle at 12% 18%, rgba(255,255,255,.18) 0 1.5px, transparent 2px),
    radial-gradient(circle at 55% 22%, rgba(255,255,255,.14) 0 1px, transparent 2px),
    radial-gradient(circle at 78% 35%, rgba(255,255,255,.16) 0 1.5px, transparent 2px),
    radial-gradient(circle at 20% 72%, rgba(255,255,255,.12) 0 1px, transparent 2px),
    radial-gradient(circle at 88% 78%, rgba(255,255,255,.18) 0 1.5px, transparent 2px),
    radial-gradient(800px 520px at 18% 20%, rgba(255,20,147,.18), transparent 60%),
    radial-gradient(760px 520px at 80% 25%, rgba(0,191,255,.16), transparent 60%),
    radial-gradient(820px 560px at 30% 88%, rgba(191,255,0,.14), transparent 62%),
    radial-gradient(900px 560px at 92% 86%, rgba(155,48,255,.14), transparent 62%),
    linear-gradient(180deg, var(--bg1), var(--bg0));
}

.shell{
  background:
    radial-gradient(900px 520px at 20% 10%, rgba(255,20,147,.08), transparent 60%),
    radial-gradient(820px 520px at 85% 15%, rgba(0,191,255,.08), transparent 60%),
    radial-gradient(820px 520px at 35% 95%, rgba(191,255,0,.06), transparent 62%),
    linear-gradient(145deg, rgba(26,26,26,.94), rgba(13,13,13,.94));
  border: 3px solid rgba(255,255,255,.20);
  box-shadow:
    0 20px 55px rgba(0,0,0,.60),
    0 0 0 6px rgba(255,255,255,.06);
}

.shell::before{
  opacity: .06;
  filter: saturate(1.3) contrast(1.15);
}

h1{ 
  color: rgba(255,255,255,.95); 
  text-shadow: 0 2px 6px rgba(255,20,147,.35), 0 0 20px rgba(0,191,255,.15);
}

.subtitle{ color: rgba(255,255,255,.78); }

.tiny-badge{
  background: rgba(255,255,255,.10);
  border-color: rgba(255,255,255,.20);
  color: rgba(255,255,255,.85);
}

.logo-badge{
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,.28), transparent 55%),
    radial-gradient(circle at 50% 55%, rgba(0,191,255,.32), transparent 60%),
    radial-gradient(circle at 60% 55%, rgba(255,20,147,.28), transparent 62%),
    radial-gradient(circle at 45% 70%, rgba(191,255,0,.22), transparent 60%),
    rgba(26,26,26,.92);
  border: 3px solid rgba(255,255,255,.28);
  color: rgba(255,255,255,.98);
  box-shadow:
    0 10px 30px rgba(0,0,0,.60),
    0 0 0 4px rgba(0,191,255,.12);
}

.panel{
  background: var(--panel);
  border: 1px solid var(--stroke);
  box-shadow: 0 10px 28px rgba(0,0,0,.45);
}

.panel h2{ color: rgba(255,255,255,.95); }

.group-label{
  color: rgba(255,255,255,.65);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-size: 0.8rem;
}

.chip{
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.20);
  color: rgba(255,255,255,.90);
  box-shadow: 0 2px 0 rgba(0,0,0,.40);
}

.chip-dot{
  background: var(--neon-blue);
  box-shadow: 0 0 0 2px rgba(0,191,255,.30), 0 0 16px rgba(0,191,255,.28);
}

.chip.selected{
  background: linear-gradient(135deg, rgba(255,20,147,.95), rgba(155,48,255,.90));
  border-color: rgba(255,255,255,.25);
  color: #0d0d0d;
  font-weight: 700;
}

.chip.selected .chip-dot{
  background: var(--neon-yellow);
  box-shadow: 0 0 0 2px rgba(255,215,0,.40), 0 0 16px rgba(255,215,0,.25);
}

.reset-btn{
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.28);
  color: rgba(255,255,255,.95);
  box-shadow: 0 3px 0 rgba(0,0,0,.40);
}

.reset-btn:active{
  box-shadow: 0 1px 0 rgba(0,0,0,.40);
}

.pill-indicator{
  background: rgba(255,255,255,.10);
  color: rgba(255,255,255,.92);
  box-shadow: 0 2px 0 rgba(0,0,0,.40);
  border: 1px solid rgba(255,255,255,.16);
}

#dataStatus.pill-indicator.live{
  background: linear-gradient(120deg, rgba(0,191,255,.95), rgba(191,255,0,.85));
  color: #0d0d0d;
  border-color: rgba(255,255,255,.20);
  font-weight: 700;
}

#dataStatus.pill-indicator.offline{
  background: linear-gradient(120deg, rgba(255,20,147,.92), rgba(255,107,53,.88));
  color: #0d0d0d;
  border-color: rgba(255,255,255,.20);
  font-weight: 700;
}

#output{
  color: rgba(255,255,255,.85);
}

.hint{
  color: rgba(255,255,255,.60);
}

.data-meta,
.matches-empty{
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.16);
  color: rgba(255,255,255,.80);
}

.wheel-card{
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.16);
}

.wheel-name{
  color: rgba(255,255,255,.95);
}

.wheel-availability{
  background: rgba(191,255,0,.22);
  border-color: rgba(191,255,0,.50);
  color: rgba(255,255,255,.95);
  font-weight: 800;
}

.wheel-availability.none{
  background: rgba(255,20,147,.20);
  border-color: rgba(255,20,147,.50);
}

.tag{
  background: rgba(0,0,0,.12);
  border-color: rgba(255,255,255,.16);
  color: rgba(255,255,255,.88);
}

.tag-dot{ 
  background: var(--neon-purple);
  box-shadow: 0 0 8px rgba(155,48,255,.25);
}

.wheel-footer{
  color: rgba(255,255,255,.70);
}

.borrow-btn{
  background: linear-gradient(135deg, rgba(255,20,147,.92), rgba(155,48,255,.88));
  color: #0d0d0d;
  border-color: rgba(255,255,255,.20);
  font-weight: 800;
}

.borrow-btn:active{
  transform: translateY(1px);
}

.footnote{
  color: rgba(255,255,255,.65);
  border-top: 1px dashed rgba(255,255,255,.14);
}

#loanLog h3{
  color: rgba(255,255,255,.92);
}

.loan-item{
  border-bottom: 1px dotted rgba(255,255,255,.14);
  color: rgba(255,255,255,.85);
}

.loan-note{
  color: rgba(255,255,255,.65);
}

/* =========================
   REVIEW FORM STYLING
   ========================= */

/* Floating Review Button */
.review-fab {
  position: fixed;
  bottom: 80px;
  right: 20px;
  background: linear-gradient(135deg, var(--neon-pink), var(--neon-purple));
  color: #0d0d0d;
  border: 2px solid rgba(255,255,255,.25);
  border-radius: 50px;
  padding: 12px 24px;
  font-size: 1rem;
  font-weight: 800;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(255,20,147,.4), 0 0 20px rgba(255,20,147,.2);
  z-index: 1000;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.review-fab:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255,20,147,.6), 0 0 30px rgba(255,20,147,.3);
}

.review-fab:active {
  transform: translateY(0);
}

/* Review Modal */
.review-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.85);
  z-index: 2000;
  overflow-y: auto;
  padding: 20px;
}

.review-modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
}

.review-modal-content {
  background: linear-gradient(145deg, rgba(26,26,26,.98), rgba(13,13,13,.98));
  border: 2px solid rgba(255,255,255,.2);
  border-radius: 20px;
  max-width: 600px;
  width: 100%;
  padding: 0;
  box-shadow: 0 20px 60px rgba(0,0,0,.8);
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.review-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  border-bottom: 1px solid rgba(255,255,255,.1);
}

.review-modal-header h2 {
  margin: 0;
  font-size: 1.4rem;
  color: rgba(255,255,255,.95);
  font-family: "Baloo 2", system-ui, sans-serif;
}

.review-close {
  background: none;
  border: none;
  color: rgba(255,255,255,.7);
  font-size: 2rem;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
  line-height: 1;
  transition: color 0.2s ease;
}

.review-close:hover {
  color: var(--neon-pink);
}

.privacy-notice {
  background: rgba(0,191,255,.08);
  border-left: 3px solid var(--neon-blue);
  padding: 12px 16px;
  margin: 20px 24px;
  border-radius: 8px;
  font-size: 0.85rem;
  color: rgba(255,255,255,.85);
  line-height: 1.4;
}

#reviewForm {
  padding: 0 24px 24px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 6px;
  font-size: 0.9rem;
  font-weight: 600;
  color: rgba(255,255,255,.85);
}

.form-group input[type="text"],
.form-group input[type="tel"],
.form-group input[type="number"],
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px;
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 8px;
  color: rgba(255,255,255,.95);
  font-size: 0.95rem;
  font-family: inherit;
  transition: border-color 0.2s ease, background 0.2s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--neon-blue);
  background: rgba(255,255,255,.12);
}

.form-group textarea {
  resize: vertical;
  min-height: 100px;
}

/* Star Rating */
.star-rating {
  display: flex;
  gap: 8px;
  font-size: 2rem;
}

.star {
  cursor: pointer;
  color: rgba(255,255,255,.3);
  transition: color 0.2s ease, transform 0.1s ease;
}

.star:hover,
.star.active {
  color: var(--neon-yellow);
  transform: scale(1.1);
}

/* Form Actions */
.form-actions {
  display: flex;
  gap: 12px;
  margin-top: 24px;
}

.btn-primary,
.btn-secondary {
  flex: 1;
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 0.95rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 2px solid;
}

.btn-primary {
  background: linear-gradient(135deg, var(--neon-pink), var(--neon-purple));
  border-color: rgba(255,255,255,.25);
  color: #0d0d0d;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(255,20,147,.4);
}

.btn-secondary {
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.25);
  color: rgba(255,255,255,.9);
}

.btn-secondary:hover {
  background: rgba(255,255,255,.12);
}

.form-message {
  margin-top: 16px;
  padding: 12px;
  border-radius: 8px;
  font-size: 0.9rem;
  display: none;
}

.form-message.success {
  display: block;
  background: rgba(191,255,0,.15);
  border: 1px solid rgba(191,255,0,.5);
  color: rgba(255,255,255,.95);
}

.form-message.error {
  display: block;
  background: rgba(255,20,147,.15);
  border: 1px solid rgba(255,20,147,.5);
  color: rgba(255,255,255,.95);
}

/* Mobile Responsive */
@media (max-width: 780px) {
  .review-fab {
    bottom: 70px;
    right: 16px;
    padding: 10px 20px;
    font-size: 0.9rem;
  }
  
  .review-modal {
    padding: 10px;
  }
  
  .review-modal-content {
    max-width: 100%;
  }
}
    // DEBUG: Force attach click listener
    console.log('Manually attaching review button listener');
    document.getElementById('reviewBtn').onclick = function() {
      console.log('Review button clicked!');
      if (!inventory || inventory.length === 0) {
        alert('Wheel inventory is still loading. Please wait a moment and try again.');
        return;
      }
      document.getElementById('reviewModal').classList.add('active');
      populateWheelDropdown();
    };

</script>


  </style>

</head>

<body>
  <div class="shell">
    <div class="content">
      <header>
        <div class="logo-badge">üõº</div>

        <div class="title-block">
          <h1>Wheel Library</h1>
          <div class="subtitle">
            Let skaters try wheels before they buy ‚Äì pick the vibe, match the set.
          </div>
          <div class="badge-strip">
            <div class="tiny-badge">Retro ‚Ä¢ Rink ‚Ä¢ Derby ‚Ä¢ Street</div>
            <div class="tiny-badge">Try &amp; Return</div>
          </div>
        </div>

        <div class="actions-top">
          <button class="reset-btn" id="resetFilters">Reset filters</button>
          <div class="pill-indicator"><span>‚óè</span> Live filter</div>
          <div class="pill-indicator" id="dataStatus"><span>‚óè</span> Loading data‚Ä¶</div>
        </div>
      </header>

      <main>
        <!-- LEFT: Filters & notes -->
        <section class="panel">
          <h2><span class="emoji">üéöÔ∏è</span> Choose your session</h2>

          <div class="group" data-group="environment">
            <div class="group-label">Environment</div>
            <div class="buttons">
              <button class="chip" data-group="environment" data-value="Indoor - Rhythm"><span class="chip-dot"></span> Indoor ‚Äì Rhythm</button>
              <button class="chip" data-group="environment" data-value="Indoor - Jam"><span class="chip-dot"></span> Indoor ‚Äì Jam</button>
              <button class="chip" data-group="environment" data-value="Indoor - Artistic"><span class="chip-dot"></span> Indoor ‚Äì Artistic</button>
              <button class="chip" data-group="environment" data-value="Indoor - Skatepark"><span class="chip-dot"></span> Indoor ‚Äì Skatepark</button>
              <button class="chip" data-group="environment" data-value="Indoor - Derby"><span class="chip-dot"></span> Indoor ‚Äì Derby</button>
              <button class="chip" data-group="environment" data-value="Outdoor - Paved path"><span class="chip-dot"></span> Outdoor ‚Äì Path</button>
              <button class="chip" data-group="environment" data-value="Outdoor - Skatepark"><span class="chip-dot"></span> Outdoor ‚Äì Skatepark</button>
              <button class="chip" data-group="environment" data-value="Outdoor - Street"><span class="chip-dot"></span> Outdoor ‚Äì Street</button>
            </div>
          </div>

          <div class="group" data-group="size">
            <div class="group-label">Wheel size</div>
            <div class="buttons">
              <button class="chip" data-group="size" data-value="57mm"><span class="chip-dot"></span> 57mm</button>
              <button class="chip" data-group="size" data-value="59mm"><span class="chip-dot"></span> 59mm</button>
              <button class="chip" data-group="size" data-value="62mm"><span class="chip-dot"></span> 62mm</button>
              <button class="chip" data-group="size" data-value="65mm+"><span class="chip-dot"></span> 65mm+</button>
            </div>
          </div>

          <div class="group" data-group="duro">
            <div class="group-label">Durometer (hardness)</div>
            <div class="buttons">
              <button class="chip" data-group="duro" data-value="88A‚Äì92A"><span class="chip-dot"></span> 88A‚Äì92A (softer)</button>
              <button class="chip" data-group="duro" data-value="93A‚Äì96A"><span class="chip-dot"></span> 93A‚Äì96A (mid)</button>
              <button class="chip" data-group="duro" data-value="97A‚Äì103A"><span class="chip-dot"></span> 97A‚Äì103A (hard)</button>
            </div>
          </div>

          <div class="group" data-group="material">
            <div class="group-label">Material</div>
            <div class="buttons">
              <button class="chip" data-group="material" data-value="Urethane"><span class="chip-dot"></span> Urethane</button>
              <button class="chip" data-group="material" data-value="Fiberglass"><span class="chip-dot"></span> Fiberglass</button>
              <button class="chip" data-group="material" data-value="Modern Vanathane"><span class="chip-dot"></span> Modern Vanathane</button>
              <button class="chip" data-group="material" data-value="Vintage Vanathane"><span class="chip-dot"></span> Vintage Vanathane</button>
              <button class="chip" data-group="material" data-value="Wood"><span class="chip-dot"></span> Wood</button>
              <button class="chip" data-group="material" data-value="Clay"><span class="chip-dot"></span> Clay</button>
            </div>
          </div>

          <div id="output">
            <strong>Tap a few chips to set the vibe.</strong>
            <p>Your picks will show here with quick notes on what usually works.</p>
          </div>

          <div class="hint">
            Choose as many or as few filters as you like. The right panel only shows wheels that are actually free to borrow.
          </div>
        </section>

        <!-- RIGHT: Matching wheels + borrower mockup -->
        <section class="panel">
          <h2><span class="emoji">üì¶</span> Wheels ready to borrow</h2>

          <div class="data-meta" id="dataMeta">
            Data source: <strong>Google Sheets</strong> ‚Ä¢ Last synced: <span id="lastUpdated">‚Äî</span>
          </div>

          <div id="matches">
            <div class="matches-empty">
              No filters yet. Start by choosing where you‚Äôre skating (rink, path, street, park‚Ä¶).
            </div>
          </div>

          <div id="loanLog">
            <h3>üìù Today‚Äôs check-outs</h3>
            <div class="loan-empty">
              No loans logged yet. Tap ‚ÄúBorrow this set‚Äù on a wheel card to mock up a checkout.
            </div>
          </div>

          <div class="footnote">
            This is a visual mockup for the lending flow. In a full app, this log would sync to a sheet or database so you can track who has what.
          </div>
        </section>
      </main>

      <!-- REVIEW BUTTON -->
      <button class="review-fab" id="reviewBtn" title="Submit a Review">
        ‚≠ê Review
      </button>

      <!-- REVIEW MODAL -->
      <div class="review-modal" id="reviewModal">
        <div class="review-modal-content">
          <div class="review-modal-header">
            <h2>üõº Submit a Wheel Review</h2>
            <button class="review-close" id="closeModal">&times;</button>
          </div>

          <div class="privacy-notice">
            <strong>Privacy Notice:</strong> Your phone number is used only to verify Skate Flow Fam membership and will never be displayed publicly. Only your display name will appear on reviews.
          </div>

          <form id="reviewForm">
            <div class="form-group">
              <label for="phoneNumber">Phone Number *</label>
              <input type="tel" id="phoneNumber" name="phone_number" placeholder="(555) 123-4567" required>
            </div>

            <div class="form-group">
              <label for="displayName">Display Name (from WhatsApp group) *</label>
              <input type="text" id="displayName" name="display_name" placeholder="Your name as it appears in SFF group" required>
            </div>

            <div class="form-group">
              <label for="wheelSelect">Wheel Being Reviewed *</label>
              <select id="wheelSelect" name="wheel_id" required>
                <option value="">-- Select a wheel --</option>
              </select>
            </div>

            <div class="form-group">
              <label for="experienceLevel">Your Skating Experience *</label>
              <select id="experienceLevel" name="experience_level" required>
                <option value="">-- Select experience level --</option>
                <option value="Beginner (less than 1 year)">Beginner (less than 1 year)</option>
                <option value="Intermediate (1-3 years)">Intermediate (1-3 years)</option>
                <option value="Advanced (3-5 years)">Advanced (3-5 years)</option>
                <option value="Expert (5+ years)">Expert (5+ years)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="hoursOnWheels">Hours on These Wheels *</label>
              <input type="number" id="hoursOnWheels" name="hours_on_wheels" min="0" placeholder="Approximate hours" required>
            </div>

            <div class="form-group">
              <label for="rating">Star Rating (optional)</label>
              <div class="star-rating" id="starRating">
                <span class="star" data-value="1">‚òÜ</span>
                <span class="star" data-value="2">‚òÜ</span>
                <span class="star" data-value="3">‚òÜ</span>
                <span class="star" data-value="4">‚òÜ</span>
                <span class="star" data-value="5">‚òÜ</span>
              </div>
              <input type="hidden" id="ratingValue" name="rating" value="">
            </div>

            <div class="form-group">
              <label for="environment">Used For (optional)</label>
              <select id="environment" name="environment">
                <option value="">-- Select environment --</option>
                <option value="Indoor - Rhythm">Indoor - Rhythm</option>
                <option value="Indoor - Jam">Indoor - Jam</option>
                <option value="Indoor - Artistic">Indoor - Artistic</option>
                <option value="Indoor - Skatepark">Indoor - Skatepark</option>
                <option value="Indoor - Derby">Indoor - Derby</option>
                <option value="Outdoor - Paved path">Outdoor - Paved path</option>
                <option value="Outdoor - Skatepark">Outdoor - Skatepark</option>
                <option value="Outdoor - Street">Outdoor - Street</option>
              </select>
            </div>

            <div class="form-group">
              <label for="reviewText">Your Review *</label>
              <textarea id="reviewText" name="review_text" rows="6" placeholder="Share your experience with these wheels..." required></textarea>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" id="cancelBtn">Cancel</button>
              <button type="submit" class="btn-primary">Submit Review</button>
            </div>
          </form>

          <div id="formMessage" class="form-message"></div>
        </div>
      </div>

    </div>
  </div>

 <script>
    const selections = { environment: null, size: null, duro: null, material: null };
    const loans = [];

    const SHEET_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTX7hy9M2WFiK5F_idUtMvnvfDZnz6-PdqeLP660gPQJI50eBQygHbWdhd3pvYF4H307QqK-0nIFero/pub?gid=0&single=true&output=csv";
    
    // Review form Apps Script URL
    const REVIEW_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbynqdoLigNVyALncipI-FaDVl7mUjxgBqgD0cCn730ONoVGlc_IYHsFF06SlDQih8sP/exec";
    
    function parseCSV(text) {
      const rows = [];
      let row = [];
      let cell = "";
      let inQuotes = false;

      text = text.replace(/\r\n/g, "\n").replace(/\r/g, "\n");

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const next = text[i + 1];

        if (char === '"') {
          if (inQuotes && next === '"') {
            cell += '"';
            i++;
          } else {
            inQuotes = !inQuotes;
          }
          continue;
        }

        if (char === "," && !inQuotes) {
          row.push(cell.trim());
          cell = "";
          continue;
        }

        if (char === "\n" && !inQuotes) {
          row.push(cell.trim());
          if (row.some((v) => v !== "")) rows.push(row);
          row = [];
          cell = "";
          continue;
        }

        cell += char;
      }

      row.push(cell.trim());
      if (row.some((v) => v !== "")) rows.push(row);

      return rows;
    }

    async function loadInventoryFromSheet() {
      const res = await fetch(SHEET_URL);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      const text = await res.text();
      if (text.toLowerCase().includes("<html")) {
        throw new Error("Got HTML instead of CSV (publish/share issue)");
      }

      const rows = parseCSV(text);
      if (!rows.length) return [];

      const headers = rows[0].map((h) => h.toLowerCase());
      const data = rows.slice(1);

      return data.map((row) => {
        const obj = {};
        headers.forEach((h, i) => (obj[h] = row[i] || ""));

        return {
          id: obj.wheel_id,
          name: obj.wheel_name,
          brand: obj.brand,
          size: obj.wheel_size,
          material: obj.wheel_material,
          duroRange: obj.durometer_category,
          bestFor: obj.best_for ? obj.best_for.split(",").map((s) => s.trim()) : [],
          totalSets: 1,
          onLoanSets:
            obj.status && String(obj.status).toLowerCase() !== "available" ? 1 : 0,
        };
      });
    }

    let inventory = [];

    function setDataStatus(state, label) {
      const el = document.getElementById("dataStatus");
      if (!el) return;
      el.classList.remove("live", "offline");
      if (state) el.classList.add(state);
      el.innerHTML = `<span>‚óè</span> ${label}`;
    }

    function setLastUpdated(dateObj) {
      const el = document.getElementById("lastUpdated");
      if (!el) return;
      el.textContent = dateObj.toLocaleString([], {
        month: "short",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
      });
    }

    function updateOutput() {
      const { environment, size, duro, material } = selections;
      const output = document.getElementById("output");

      if (!environment && !size && !duro && !material) {
        output.innerHTML = `
          <strong>Tap a few chips to set the vibe.</strong>
          <p>Your picks will show here with quick notes on what usually works.</p>
        `;
        updateMatches();
        return;
      }

      let html = "<h3>Your selections</h3><ul>";
      if (environment) html += `<li><strong>Environment:</strong> ${environment}</li>`;
      if (size) html += `<li><strong>Size:</strong> ${size}</li>`;
      if (duro) html += `<li><strong>Durometer:</strong> ${duro}</li>`;
      if (material) html += `<li><strong>Material:</strong> ${material}</li>`;
      html += "</ul>";

      html += "<h3>Peach's quick notes</h3>";

      if (["Indoor - Rhythm", "Indoor - Artistic", "Indoor - Derby"].includes(environment)) {
        html += "<p>Indoor floors usually like mid‚Äìhard wheels (around 93A‚Äì96A) in the 57‚Äì62mm range for control and response.</p>";
      }
      if (environment === "Indoor - Rhythm") html += "<p>Rhythm skaters often prefer mid-hard wheels with smooth roll and predictable grip for clean footwork.</p>";
      if (environment === "Indoor - Jam") html += "<p>Jam skating usually feels best on harder wheels (97A‚Äì103A) that make spins and slides feel easy.</p>";
      if (environment === "Indoor - Artistic") html += "<p>Artistic disciplines love precise, responsive wheels ‚Äî typically mid-to-hard with solid edge control.</p>";
      if (environment === "Indoor - Derby") html += "<p>Derby setups focus on control and lateral stability, often in the mid-hard range so you can stop and start fast.</p>";

      if (environment === "Outdoor - Paved path" || environment === "Outdoor - Street") {
        html += "<p>For paths and streets, softer wheels and larger sizes help smooth out cracks and rough patches.</p>";
      }
      if (environment === "Outdoor - Skatepark" || environment === "Indoor - Skatepark") {
        html += "<p>Skateparks often feel best on harder wheels with a bit of slide, especially on smooth concrete bowls and ramps.</p>";
      }

      if (duro === "88A‚Äì92A") html += "<p>You picked a softer range ‚Äì good for comfort, grip, and rougher surfaces.</p>";
      if (duro === "93A‚Äì96A") html += "<p>Mid-range hardness ‚Äì a nice balance between grip and roll for most indoor use.</p>";
      if (duro === "97A‚Äì103A") html += "<p>Hard wheels (97A‚Äì103A) are great for slide, agility, and very smooth surfaces.</p>";

      if (material === "Urethane") html += "<p>Urethane is the modern standard ‚Äî predictable, durable, and available in almost every hardness.</p>";
      if (material === "Fiberglass") html += "<p>Fiberglass blends can feel very fast and precise, often used for specialty slide setups.</p>";
      if (material === "Modern Vanathane") html += "<p>Modern Vanathane gives a slidey, lively feel with a bit more consistency than true vintage formulas.</p>";
      if (material === "Vintage Vanathane") html += "<p>Vintage Vanathane has that classic 70s‚Äì80s vibe ‚Äî unique slide, lots of character, usually on very smooth indoor floors.</p>";
      if (material === "Wood") html += "<p>Wood wheels are extremely old-school and very slidey ‚Äî best for smooth rinks and confident skaters.</p>";
      if (material === "Clay") html += "<p>Clay wheels are quirky vintage: they can feel both grippy and chattery, and really want a very smooth artistic floor.</p>";

      output.innerHTML = html;
      updateMatches();
    }

    function updateMatches() {
      const { environment, size, duro, material } = selections;
      const matchesDiv = document.getElementById("matches");

      if (!inventory.length) {
        matchesDiv.innerHTML = `
          <div class="matches-empty">
            Loading live wheel data‚Ä¶ If this doesn't load, you may be offline.
          </div>
        `;
        return;
      }

      const matches = inventory.filter((wheel) => {
        const availableSets = wheel.totalSets - wheel.onLoanSets;
        if (availableSets <= 0) return false;
        if (environment && !wheel.bestFor.includes(environment)) return false;
        if (size && wheel.size !== size) return false;
        if (duro && wheel.duroRange !== duro) return false;
        if (material && wheel.material !== material) return false;
        return true;
      });

      if (!environment && !size && !duro && !material) {
        matchesDiv.innerHTML = `
          <div class="matches-empty">
            No filters yet. Start by choosing where you're skating (rink, path, street, park‚Ä¶).
          </div>
        `;
        return;
      }

      if (matches.length === 0) {
        matchesDiv.innerHTML = `
          <div class="matches-empty">
            No wheels match that combo and are free to borrow right now. Try relaxing one of the filters.
          </div>
        `;
        return;
      }

      let html = "";
      matches.forEach((wheel) => {
        const availableSets = wheel.totalSets - wheel.onLoanSets;
        html += `
          <div class="wheel-card">
            <div class="wheel-header">
              <div class="wheel-name">${wheel.name}</div>
              <div class="wheel-availability${availableSets <= 0 ? " none" : ""}">
                ${availableSets} set${availableSets !== 1 ? "s" : ""} available
              </div>
            </div>
            <div class="tag-row">
              <span class="tag"><span class="tag-dot"></span>${wheel.brand}</span>
              <span class="tag"><span class="tag-dot"></span>${wheel.size}</span>
              <span class="tag"><span class="tag-dot"></span>${wheel.duroRange}</span>
              <span class="tag"><span class="tag-dot"></span>${wheel.material}</span>
            </div>
            <div class="wheel-footer">
              <span>Best for: ${wheel.bestFor.join(", ")}</span>
              <button class="borrow-btn" data-wheel-id="${wheel.id}">Borrow this set</button>
            </div>
          </div>
        `;
      });

      matchesDiv.innerHTML = html;

      document.querySelectorAll(".borrow-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-wheel-id");
          handleBorrow(id);
        });
      });
    }

    function handleBorrow(wheelId) {
      const wheel = inventory.find((w) => w.id === wheelId);
      if (!wheel) return;

      const availableSets = wheel.totalSets - wheel.onLoanSets;
      if (availableSets <= 0) {
        alert("All sets of this wheel are already out on loan.");
        return;
      }

      const name = prompt("Skater name (or description)?\nExample: Jess ‚Äì purple helmet");
      if (!name) return;

      const now = new Date();
      const timeStr = now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
      const note = `Checked out around ${timeStr}.`;

      wheel.onLoanSets += 1;

      loans.unshift({
        id: "loan-" + now.getTime(),
        wheelName: wheel.name,
        borrower: name.trim(),
        time: timeStr,
        note,
      });

      renderLoans();
      updateMatches();
    }

    function renderLoans() {
      const container = document.getElementById("loanLog");
      let html = '<h3>üìù Today's check-outs</h3>';

      if (loans.length === 0) {
        html += '<div class="loan-empty">No loans logged yet. Tap "Borrow this set" on a wheel card to mock up a checkout.</div>';
        container.innerHTML = html;
        return;
      }

      loans.slice(0, 8).forEach((loan) => {
        html += `
          <div class="loan-item">
            <div class="loan-main">
              <span class="loan-borrower">${loan.borrower}</span>
              <span>${loan.time}</span>
            </div>
            <div class="loan-note">
              ${loan.wheelName}<br />
              ${loan.note}
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // Populate wheel dropdown from inventory
    function populateWheelDropdown() {
      const wheelSelect = document.getElementById('wheelSelect');
      wheelSelect.innerHTML = '<option value="">-- Select a wheel --</option>';
      
      if (!inventory || inventory.length === 0) {
        wheelSelect.innerHTML += '<option value="" disabled>No wheels available yet</option>';
        return;
      }
      
      inventory.forEach(wheel => {
        const option = document.createElement('option');
        option.value = wheel.id;
        option.textContent = `${wheel.name} (${wheel.brand})`;
        option.setAttribute('data-wheel-name', wheel.name);
        wheelSelect.appendChild(option);
      });
    }

    document.querySelectorAll(".chip").forEach((chip) => {
      chip.addEventListener("click", () => {
        const group = chip.dataset.group;
        const value = chip.dataset.value;

        if (chip.classList.contains("selected")) {
          chip.classList.remove("selected");
          selections[group] = null;
          updateOutput();
          return;
        }

        document.querySelectorAll(`.chip[data-group="${group}"]`).forEach((c) => c.classList.remove("selected"));
        chip.classList.add("selected");
        selections[group] = value;
        updateOutput();
      });
    });

    document.getElementById("resetFilters").addEventListener("click", () => {
      Object.keys(selections).forEach((key) => (selections[key] = null));
      document.querySelectorAll(".chip").forEach((c) => c.classList.remove("selected"));
      updateOutput();
    });

    setDataStatus("", "Loading data‚Ä¶");
    updateOutput();
    renderLoans();

    loadInventoryFromSheet()
      .then((inv) => {
        if (inv && inv.length) {
          inventory = inv;
          setDataStatus("live", "LIVE DATA (synced)");
          setLastUpdated(new Date());
          updateOutput();
          renderLoans();
        } else {
          setDataStatus("offline", "NO LIVE DATA");
          updateOutput();
        }
      })
      .catch((err) => {
        console.log("Failed to load sheet", err);
        setDataStatus("offline", "OFFLINE / NO LIVE DATA");
        updateOutput();
      });
    // =========================
    // REVIEW FORM FUNCTIONALITY
    // =========================
    
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Setting up review form...');
      
      const reviewBtn = document.getElementById('reviewBtn');
      const reviewModal = document.getElementById('reviewModal');
      const closeModal = document.getElementById('closeModal');
      const cancelBtn = document.getElementById('cancelBtn');
      const reviewForm = document.getElementById('reviewForm');
      const starRating = document.getElementById('starRating');
      const ratingValue = document.getElementById('ratingValue');
      const formMessage = document.getElementById('formMessage');

      if (!reviewBtn) {
        console.error('Review button not found!');
        return;
      }

      console.log('Review button found, attaching listener');

      // Open modal
      reviewBtn.addEventListener('click', function() {
        console.log('Review button clicked!');
        if (!inventory || inventory.length === 0) {
          alert('Wheel inventory is still loading. Please wait a moment and try again.');
          return;
        }
        reviewModal.classList.add('active');
        populateWheelDropdown();
      });

      // Close modal
      closeModal.addEventListener('click', function() {
        reviewModal.classList.remove('active');
        reviewForm.reset();
        formMessage.style.display = 'none';
      });

      cancelBtn.addEventListener('click', function() {
        reviewModal.classList.remove('active');
        reviewForm.reset();
        formMessage.style.display = 'none';
      });

      // Close on outside click
      reviewModal.addEventListener('click', function(e) {
        if (e.target === reviewModal) {
          reviewModal.classList.remove('active');
          reviewForm.reset();
          formMessage.style.display = 'none';
        }
      });

      // Star rating functionality
      const stars = starRating.querySelectorAll('.star');
      stars.forEach(star => {
        star.addEventListener('click', function() {
          const value = star.getAttribute('data-value');
          ratingValue.value = value;
          
          stars.forEach(s => {
            if (s.getAttribute('data-value') <= value) {
              s.classList.add('active');
              s.textContent = '‚òÖ';
            } else {
              s.classList.remove('active');
              s.textContent = '‚òÜ';
            }
          });
        });
      });

      // Handle form submission
      reviewForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitBtn = reviewForm.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
        
        formMessage.style.display = 'none';
        formMessage.className = 'form-message';
        
        try {
          const wheelSelect = document.getElementById('wheelSelect');
          const selectedOption = wheelSelect.options[wheelSelect.selectedIndex];
          const wheelName = selectedOption.getAttribute('data-wheel-name');
          
          const formData = {
            phone_number: document.getElementById('phoneNumber').value,
            display_name: document.getElementById('displayName').value,
            wheel_id: wheelSelect.value,
            wheel_name: wheelName,
            experience_level: document.getElementById('experienceLevel').value,
            hours_on_wheels: document.getElementById('hoursOnWheels').value,
            rating: ratingValue.value || '',
            review_text: document.getElementById('reviewText').value,
            environment: document.getElementById('environment').value || ''
          };
          
          const response = await fetch(REVIEW_SCRIPT_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });
          
          const result = await response.json();
          
          if (result.success) {
            formMessage.className = 'form-message success';
            formMessage.textContent = '‚úÖ Review submitted successfully! Thank you for sharing your experience.';
            formMessage.style.display = 'block';
            
            setTimeout(function() {
              reviewModal.classList.remove('active');
              reviewForm.reset();
              formMessage.style.display = 'none';
              
              stars.forEach(s => {
                s.classList.remove('active');
                s.textContent = '‚òÜ';
              });
            }, 2000);
          } else {
            throw new Error(result.error || 'Submission failed');
          }
          
        } catch (error) {
          console.error('Review submission error:', error);
          formMessage.className = 'form-message error';
          formMessage.textContent = '‚ùå Failed to submit review. Please try again or contact support.';
          formMessage.style.display = 'block';
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Review';
        }
      });

      console.log('Review form setup complete!');
    });
  </script>
 <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
  <script>eruda.init();</script>
  <script>

    // PWA: register service worker (safe no-op if unsupported)
    
    if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./service-worker.js").then((reg) => {
      // Check for updates every time the page loads
      reg.update();
      
      console.log("Service Worker registered");
      
      // Listen for updates
      reg.addEventListener("updatefound", () => {
        const newWorker = reg.installing;
        newWorker.addEventListener("statechange", () => {
          if (newWorker.state === "activated") {
            console.log("New service worker activated - reload to see changes");
            // Optional: automatically reload
            // window.location.reload();
          }
        });
      });
    }).catch(console.log);
  });
}
  </script>
</body>
</html>